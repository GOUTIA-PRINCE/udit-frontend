<div class="catalog-container">
    <aside class="filters">
        <h3>Filtres</h3>

        <div class="filter-group" *ngIf="searchTerm">
            <p>Recherche : <strong>{{ searchTerm }}</strong></p>
            <button class="btn-sm" (click)="searchTerm = ''; applyFilters()">Effacer</button>
        </div>

        <div class="filter-group">
            <h4>Catégories</h4>
            <label *ngFor="let cat of categories">
                <input type="checkbox" [(ngModel)]="selectedCategories[cat]" (change)="onCategoryChange()"> {{ cat }}
            </label>
        </div>
        <div class="filter-group">
            <h4>Prix max: {{ maxPrice }} FCFA</h4>
            <input type="range" min="0" [max]="maxPriceLimit" step="1000" [(ngModel)]="maxPrice"
                (input)="applyFilters()">
        </div>
    </aside>

    <section class="product-list-container">
        <div class="list-actions">
            <div class="items-per-page">
                <label for="itemsPerPage">Produits par page :</label>
                <select id="itemsPerPage" [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()">
                    <option [value]="5">5</option>
                    <option [value]="10">10</option>
                    <option [value]="20">20</option>
                    <option [value]="50">50</option>
                </select>
            </div>
            <div class="results-count">
                {{ filteredProducts.length }} produit(s) trouvé(s)
            </div>
        </div>

        <div class="product-list">
            <div class="product-card" *ngFor="let product of paginatedProducts">
                <div class="product-image" [routerLink]="['/catalog', product.id]">
                    <img [src]="product.image" [alt]="product.name">
                </div>
                <div class="product-info">
                    <h3 [routerLink]="['/catalog', product.id]">{{ product.name }}</h3>
                    <p class="price">{{ product.price }} FCFA</p>
                    <button class="btn btn-primary" (click)="orderOnWhatsApp(product)">Commander</button>
                </div>
            </div>
        </div>

        <div class="no-results" *ngIf="filteredProducts.length === 0">
            <p>Aucun produit ne correspond à vos critères.</p>
        </div>

        <div class="pagination" *ngIf="totalPages > 1">
            <button class="btn-pagination" [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">
                <i class="fas fa-chevron-left"></i> Précédent
            </button>
            <div class="page-numbers">
                <button *ngFor="let p of [].constructor(totalPages); let i = index" class="page-num"
                    [class.active]="currentPage === i + 1" (click)="goToPage(i + 1)">
                    {{ i + 1 }}
                </button>
            </div>
            <button class="btn-pagination" [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">
                Suivant <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </section>
</div>